<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc category="info" docName="draft-kuhn-quic-0rtt-bdp-02" ipr="trust200902">
	<!-- category values: std, bcp, info, exp, and historic
     ipr values: full3667, noModification3667, noDerivatives3667
     you can add the attributes updates="NNNN" and obsoletes="NNNN"
     they will automatically be output with "(if approved)" -->

	<!-- ***** FRONT MATTER ***** -->

	<front>
		<!-- The abbreviated title is used in the page header - it is only necessary if the
         full title is longer than 39 characters -->

		<title abbrev="Transport for 0-RTT">Transport parameters for 0-RTT connections</title>

		<author role="editor" fullname="Nicolas Kuhn" initials="N" surname="Kuhn">
			<organization>CNES</organization>
			<address>
				<postal>
					<street>18 Avenue Edouard Belin</street>
					<city>Toulouse</city>
					<region/>
					<code>31400</code>
					<country>France</country>
				</postal>
				<phone/>
				<email>nicolas.kuhn@cnes.fr</email>
			</address>
		</author>

		<author role="editor" fullname="Emile Stephan" initials="E" surname="Stephan">
			<organization>Orange</organization>
			<address>
				<postal>
					<street>2, avenue Pierre Marzin</street>
					<city>Lannion</city>
					<region/>
					<code>22300</code>
					<country>France</country>
				</postal>
				<phone/>
				<email>emile.stephan@orange.com</email>
			</address>
		</author>

		<date month="April" year="2019"/>

		<!-- If the month and year are both specified and are the current ones, xml2rfc will fill
         in the current day for you. If only the current year is specified, xml2rfc will fill
	 in the current day and month for you. If the year is not the current one, it is
	 necessary to specify at least a month (xml2rfc assumes day="1" if not specified for the
	 purpose of calculating the expiry date).  With drafts it is normally sufficient to
	 specify just the year. -->

		<!-- Meta-data Declarations -->

		<area>Transport</area>

		<workgroup>Internet Engineering Task Force</workgroup>

		<!-- WG name at the upperleft corner of the doc,
         IETF is fine for individual submissions.
	 If this element is not present, the default is "Network Working Group",
         which is used by the RFC Editor as a nod to the history of the IETF. -->

		<keyword>QUIC, high BDP, Transport, 0-RTT, early_data</keyword>

		<!-- Keywords will be incorporated into HTML output
         files in a meta tag but they have no effect on text or nroff
         output. If you submit your draft to the RFC Editor, the
         keywords will be used for the search engine. -->

		<!-- ######################################################-->
		<!-- ######################################################-->
		<!-- Head of the document -->
		<!-- ######################################################-->
		<!-- ######################################################-->
		<abstract>
			<t>The NewSessionTicket record carries a field, which tells a client the volume of early data that it can include in the 0-RTT messages when reconnecting to the same peer. There are cases where additional infromation can significantly improve the time-to-service.
				This memo discusses a solution where path adaptation parameters are also shared between the peers. This can accelerate the throughput of subsequent 0-RTT connections in both direction.
			</t>
		</abstract>
	</front>

	<middle>

		<section anchor="sec:introduction" title="Introduction">
			<t>The 0-RTT mechanism is designed to accelerate the throughput when establishing a connection. There are cases where 0-RTT alone does not improve the time-to-service, 
				and additional information can therefore be beneficial.</t>

			<t>Some network paths result in a reduced time-to-service because the default parameters controlling the initialization of the transport and congestion control are
				not suitable for the path characteristics.
				QUIC's congestion control is based on TCP NewReno <xref target="I-D.ietf-quic-recovery"/> 
				and the recommended initial window is defined by <xref target="RFC6928"/>. 
				A path with a large bandwidth delay product can therefore significantly increase the time-to-service 
				(e.g. a path using satellite communication <xref target="IJSCN19"/> could observe 
				a much longer page load time for complex pages).</t>

			<t>This memo describes a solution where:<list style="numbers">
					<t>the server learns a fundamental characteristic of the path during the 1-RTT phase;</t>
					<t>the server sends this information to the client at the end of the 1-RTT phase;</t>
					<t>the server and the client exploit the information to improve the time-to-service during subsequent 0-RTT connections.</t>
				</list>
			</t>

		</section>

		<!-- ######################################################-->
		<!-- ######################################################-->
		<!-- Body of the document -->
		<!-- ######################################################-->
		<!-- ######################################################-->

		<!-- ######################################################-->
		<!-- New section -->
		<!-- ######################################################-->

		<section anchor="sec:quic-connec-est" title="QUIC connection establishment: differences between 1-RTT and 0-RTT connections">

			<t>This section recalls how 1-RTT and 0-RTT operate in QUIC <xref target="I-D.ietf-quic-transport"/>.</t>

			<t>QUIC leverages the 2 handshakes of TLS1.3 <xref target="I-D.ietf-quic-tls"/>: The 1-RTT handshake initiates 
				a first set of credentials. When a handshake achieves successfully, the server pushes 
				the learned information about the session to the client in an opaque session ticket 
				(see section 4.6.1 of <xref target="RFC8446"/>). This information within the opaque ticket 
				is meaningless to the client. A client willing to establish a fast re-opening of the session 
				pushes back this opaque 'ticket' in a 0-RTT handshake and sends early application data.</t>

			<t>In practice, the server sends the 'ticket' in a NewSessionTicket record <xref target="I-D.ietf-quic-tls"/>. 
				The structure of the NewSessionTicket includes the opaque 'ticket' and an 'extensions' field. 
				The NewSessionTicket carries an additional field named 'early_data' that indicates to the client 
				the maximum size of application data to insert in the 0-RTT message.</t>

		</section>

		<!-- ######################################################-->
		<!-- New section -->
		<!-- ######################################################-->

		<section anchor="sec:e2e_sol" title="End-to-end solution">

			<t>This section proposes an improvement of the initialization of 0-RTT connections over satellite communication where the client recalls the BDP previously measured by the server during the 1-RTT handshake. The approach follows the tuning of the initial window described in <xref target="I-D.irtf-iccrg-sallantin-initial-spreading"/> which has been shown to improve performance both for high BDP and more common BDP <xref target="CONEXT15"/>
				<xref target="ICC16"/>.</t>

			<section anchor="sec:e2e_sol:description" title="Description of the extension in the NewSessionTicket">
				<t>This document defines an extension named "BDP_data" for the NewSessionTicket. 
					This contains the following value: BDP_value. This is the value in bits (using the same units defined by <xref target="RFC6349"/>). 
					The reception of the field BDP_data provides the client with 3 indications:<list style="symbols">
						<t>This path to this server has a large BDP;</t>
						<t>The server added the path characteristics in the opaque 'ticket' field;</t>
						<t>The server SHOULD optimize the reopening of the session upon reception of this opaque ticket.</t>
					</list>
				</t>
			</section>

			<section anchor="sec:e2e_sol:usage" title="Usage of the extension in the NewSessionTicket">
				<t>When a server measures a connection BDP that is larger than usual, it includes 
					the path characteristics in the opaque ticket. This is sent to the client 
					in a NewSessionTicket message. The message includes an additional 'extensions' 
					field named 'BDP_data'. The client stores this session ticket and the 'BDP_data' field.</t>
				<t>When the client reconnects to the same server in 0-RTT mode, it pushes back this session 
					ticket in the ClientHello and prepares itself to receive data in the context 
					given by the 'BDP_data' field. 
					(The client does not send the 'BDP_data' field back to the server). 
					The server receives the session ticket and extracts the BDP context. 
					It can use this information to provide a throughput closer to the capacity of the path.</t>
				<t>Because the path characteristics can change over time, and may hence become invalid for use in a subsequent connection,
					the server sets the age 
					of the ticket (see section 4.2.11.1 of <xref target="RFC8446"/>) to a short duration.
					A server could also update the ticket when the path characteristics of connection are known to have changed.</t>
			</section>

		</section>

		<!-- ######################################################-->
		<!-- New section -->
		<!-- ######################################################-->

		<section anchor="sec:best-current-practice" title="Best current practice">
			<t>This section provides examples of data that could be added in the opaque ticket field by the server. 
				The details added by the server in the session ticket do not need to be standardized for 
				interoperability between QUIC clients and servers because this information is opaque to the client. 
				The presence of the "BDP_data" extension field in the NewSessionTicket informs the client that the 
				server can actively take action to improve its throughput when the session will restart.</t>
			<t>The following list describes information elements set by the server in the session ticket to accompany the signaling of field. 
				These examples are illustrated in <xref target="fig:bcp_example"/> and their purpose is detailed in this section.<list style="symbols">
					<t>A client aware of a high BDP path: Section 7.3.1 of <xref target="I-D.ietf-quic-transport"/> indicates that the "A client that attempts to send 0-RTT data MUST remember the transport parameters used by the server". 
					In addition to the default transport parameters used by the server, a server that knows that the path has a large BDP can let the client adapt its parameters.</t>
					<t>PMTU: Knowledge of the PMTU of a previous path improves the time to service because it reduces the duration of the path validation process described in section 8.2 of <xref target="I-D.ietf-quic-transport"/>.</t>
					<t>Connection RTT: The knowledge of the characteristics of a previous connection RTT can improve the throughput because a server can safely improve the slow start: e.g. using the pacing models of <xref target="I-D.irtf-iccrg-sallantin-initial-spreading"/> can result in high IW for high RTT paths and a common IW for paths with smaller RTT. The results presented in <xref target="ICC16"/> show that for both files of 15 kB and 750 kB, the proposed solution reduces the time to download by approximatively 2 seconds whether the RTT is 50ms or 500ms.</t>
					<t>Ticket_lifetime: The server sets a shorter validity duration to avoid receiving obsolete path characteristics; (e.g., this could reduce the validity to one day).</t>
				</list>
			</t>
			<figure anchor="fig:bcp_example" title="Example of opaque ticket content">
				<artwork>
           CLIENT                         SERVER
           +-----------------------------------+
           |          1 RTT connection         |
           +-----------------------------------+
             |                              |
             +&lt;---1-RTT TLS1.3 HANDSHAKE---&gt;+
             |                              | +------------+
             +&lt;-----data transmission------&gt;+ |path charact|
             |                              | |record      |
             |                              | +------------+
             |&lt;-------------NewSessionTicket+
Client aware |           +ticket_lifetime   |
of high BDP  |           +'opaque' field    |
path         |            + ...             |
             |            + PMTU            |
             |            + connection RTT  |
             |           +'extension' field |
             |            + early_data      |
             |            + BDP_data        |
             |                              |
           +-----------------------------------+
           |          0 RTT connection         |
           +-----------------------------------+
             |                              |
             +ClientHello------------------&gt;|
             |+'opaque' field               | +-------------------+
             | + ...                        | |param adaptation   |
             | + PMTU                       | |e.g.               |
             | + connection RTT             | |tuned and paced IW |
             |                              | +-------------------+
             |                              |
             +&lt;----+data transmission+-----&gt;+
             |                              |
             +                              +
				</artwork>
			</figure>

		</section>

		<!-- ######################################################-->
		<!-- New section -->
		<!-- ######################################################-->

		<section anchor="sec:issue-bad-BDP" title="What happens when BDP is used incorrectly">

			<!-- <t>This section discusses what happens when the NewSessionTicket extension 'BDP_data' is used incorrectly.</t>

			<section title="On the high BDP estimation">
				<t>There are multiple cases where accurately measuring the BDP is complexed. As one example, this is particularly challenging when the files to transmit are small.</t>
				<t>That being said, there are ways to estimate the BDP that could be relevant and legitimate the approach proposed in this document:<list style="symbols">
					<t>the server could first exploit RTT measurements to identify that the connection could require ingress traffic improvements. The server could activate the 'BDP_data' extension field.</t>
					<t>to have an accurate bandwidth estimation, the server could then exploit the way BBR estimates the available bandwidth.</t>			
				</list>
				<t>The server could have an estimation of both the RTT and the bandwidth of the network underneath. If the RTT is high, the server could activate the 'BDP_data' extension field even if the bandwidth measurement is not accurate.</t>
			</section> -->
						
			<!-- <section title="Network with small BDP - server activating BDP_data"> -->
				<t>This section discusses the impact of a server activating the 'BDP_data' field when the network underneath actually has a small BDP. This could happen when the server BDP estimate was incorrect, client has multiple paths to choose from and uses the ticket on a different path to which it was requested, or when the path characteristics change significantly.</t>
				<t>Depending on how the extension is exploited, this could result in assigning additional resources (e.g. buffer space) that later is not used. This could also motivate the requirement to pace the initial window to avoid transmitting data at a too high a rate.</t>				
			<!-- </section> -->
		</section>
		
		<!-- ######################################################-->
		<!-- New section -->
		<!-- ######################################################-->

		<section anchor="sec:discussion" title="Discussion">

			<t>This mechanism follows the approach of the extension field 'early_data' of the NewSessionTicket of TLS1.3. While 'early_data' improves the egress traffic of a client, the 'BDP_data' proposal aims at improving ingress traffic to the client. Improving the ingress traffic can result in significant improvement to the quality-of-experience. For example, this enables the use of transport parameters, such as the RTT, PMTU and BDP to adapt the initial data transmission of a 0-RTT connection. This can halve the page load time of a web page download.</t>
			<!-- <t>Deeper adaptations of the QUIC congestion control can improve the end-user experience in high BDP contexts but proposing it for other contexts may not be relevant. Indeed, designing either the data-center or the end-user stacks based on large BDP constraints can hardly be done if the deployment is not dedicated to this context (such as it would be the case with specific CDN). Adapting a generic data-center may not be viable since it may result in too aggressive behavior for more common BDP. Moreover, at the end-user side, adapting the stacks or the browser has been proposed in the past but maintenance is mre complex because there can often be a change to the version of the web browsers' version.</t> -->

		</section>

		<!-- ######################################################-->
		<!-- ######################################################-->
		<!-- Tail of the document -->
		<!-- ######################################################-->
		<!-- ######################################################-->

		<section anchor="sec:acknowledgements" title="Acknowledgements">
			<t>We thank Gorry Fairhurst for his comments on this document.</t>
		</section>

		<section anchor="sec:IANA" title="IANA Considerations">
			<t>TBD: text is required to register the extension BDP_data field.</t>
		</section>

		<section anchor="sec:security" title="Security Considerations">
			<t>The security is provided by the 1-RTT phase. The measure of BDP is made during a previous connection. The exchange and the information are protected both by the TLS encryption and the NewSessionTicket (see section 4.6.1 of <xref target="RFC8446"/>).</t>
			<t>The BDP information the server will received is protected in the opaque session ticket. The 'BDP_data' field is visible by the client only. An client which does not trust the server transport adaptation ignores any session ticket associated to a 'BDP_data' field.</t>
			<t>The server does not have to honour all the received requests (e.g. when it is resource-limited).</t>
		</section>
	</middle>

	<!--  *****BACK MATTER ***** -->
	<back>
		<!-- References split into informative and normative -->
		<!-- There are 2 ways to insert reference entries from the citation libraries:
	1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)
	2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here
	(for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")
	Both are cited textually in the same manner: by using xref elements.
	If you use the PI option, xml2rfc will, by default, try to find included files in the same
	directory as the including file. You can also define the XML_LIBRARY environment variable
	with a value containing a set of directories to search.  These can be either in the local
	filing system or remote ones accessed by http (http://domain/dir/... ).-->

		<references title="Normative References">
			&RFC2119;
		</references>

		<references title="Informative References">
			<?rfc include="reference.RFC.2488.xml"?>
			<?rfc include="reference.RFC.3135.xml"?>
			<?rfc include="reference.RFC.6349.xml"?>
			<?rfc include="reference.RFC.6928.xml"?>
			<?rfc include="reference.RFC.8446.xml"?>
			<?rfc include="reference.I-D.ietf-quic-tls.xml"?>
			<?rfc include="reference.I-D.ietf-quic-transport.xml"?>
			<?rfc include="reference.I-D.ietf-quic-recovery.xml"?>
			<?rfc include="reference.I-D.ietf-tls-ticketrequests.xml"?>
			<?rfc include="reference.I-D.irtf-iccrg-sallantin-initial-spreading.xml"?>
			<reference anchor="ICCRG100">
				<front>
					<title>MPTCP and BBR performance over Internet satellite paths</title>
					<author initials="N" surname="Kuhn">
					</author>
					<date year="2017"/>
				</front>
				<seriesInfo name="IETF ICCRG" value="100"/>
			</reference>
			<reference anchor="IJSCN19">
				<front>
					<title>Google QUIC performance over a public SATCOM access</title>
					<author initials="L" surname="Thomas">
					</author>
					<author initials="E" surname="Dubois">
					</author>
					<author initials="N" surname="Kuhn">
					</author>
					<author initials="E" surname="Lochin">
					</author>
					<date year="2019"/>
				</front>
				<seriesInfo name="International Journal of Satellite Communications and Networking" value=""/>
			</reference>
			<reference anchor="CONEXT15">
				<front>
					<title>Halfback: Running Short Flows Quickly and Safely</title>
					<author initials="Q" surname="Li">
					</author>
					<author initials="M" surname="Dong">
					</author>
					<author initials="P B" surname="Godfrey">
					</author>
					<date year="2015"/>
				</front>
				<seriesInfo name="ACM CoNEXT" value=""/>
			</reference>
			<reference anchor="NCT13">
				<front>
					<title>A new survey on improving TCP performances over geostationary satellite link</title>
					<author initials="A" surname="Pirovano">
					</author>
					<author initials="F" surname="Garcia">
					</author>
					<date year="2013"/>
				</front>
				<seriesInfo name="Network and Communication Technologies" value=""/>
			</reference>
			<reference anchor="ICC16">
				<front>
					<title>Reducing web latency through TCP IW: Be smart</title>
					<author initials="R" surname="Sallantin">
					</author>
					<author initials="C" surname="Baudoin">
					</author>
					<author initials="E" surname="Chaput">
					</author>
					<author initials="F" surname="Arnal">
					</author>
					<author initials="E" surname="Dubois">
					</author>
					<author initials="A-L" surname="Beylot">
					</author>
					<date year="2016"/>
				</front>
				<seriesInfo name="IEEE ICC" value=""/>
			</reference>
		</references>
	</back>
</rfc>
